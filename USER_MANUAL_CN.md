# Pineapple OFC Solver GUI 用戶手冊

## 目錄
1. [快速開始指南](#快速開始指南)
2. [遊戲規則說明](#遊戲規則說明)
3. [界面使用說明](#界面使用說明)
4. [進階功能](#進階功能)
5. [策略指南](#策略指南)
6. [故障排除](#故障排除)

---

## 快速開始指南

### 系統需求
- **操作系統**: Windows 10/11、macOS 10.15+、Linux (Ubuntu 20.04+)
- **Python**: 3.11 或更高版本
- **內存**: 建議 4GB 以上
- **處理器**: 多核心處理器可提升求解速度
- **瀏覽器**: Chrome、Firefox、Safari、Edge 最新版本

### 安裝步驟

1. **克隆項目倉庫**
   ```bash
   git clone https://github.com/PWChenTW/PineappleSolver.git
   cd PineappleSolver
   ```

2. **安裝依賴**
   ```bash
   pip install -r requirements.txt
   ```

3. **驗證安裝**
   ```bash
   python -c "import streamlit; import fastapi; print('安裝成功！')"
   ```

### 首次運行

1. **啟動 API 服務器**（在第一個終端窗口）
   ```bash
   python run_api.py
   ```
   成功啟動後會看到：
   ```
   INFO:     Uvicorn running on http://0.0.0.0:8000
   ```

2. **啟動 GUI 界面**（在第二個終端窗口）
   ```bash
   streamlit run gui/app_v2.py
   ```
   瀏覽器會自動打開 http://localhost:8501

3. **驗證連接**
   - 在側邊欄點擊「檢查連接」按鈕
   - 看到「✅ API 連接正常」表示系統準備就緒

---

## 遊戲規則說明

### Pineapple OFC 基本規則

#### 遊戲目標
將13張牌擺放成三個牌墩，與對手比較每墩的大小來計分。

#### 牌墩結構
- **前墩（Front）**: 3張牌 - 位於最上方
- **中墩（Middle）**: 5張牌 - 位於中間
- **後墩（Back）**: 5張牌 - 位於最下方

#### 重要規則
**牌力必須遵循：後墩 ≥ 中墩 ≥ 前墩**（違反即為犯規）

#### 發牌流程
1. **初始階段**: 發5張牌，全部必須擺放
2. **後續回合**: 每回合發3張牌，擺放2張，棄掉1張
3. **共計5個回合**: 最終每位玩家擺放13張牌

### 計分方式

#### 基礎計分
- 每墩獨立比較，贏得該墩獲得1分
- 三墩全勝（橫掃）額外獲得3分，總計6分
- 犯規直接輸掉所有墩位，對手獲得6分+犯規懲罰

#### 獎勵分數（Royalty）

**前墩獎勵**
| 牌型 | 分數 |
|------|------|
| 66 | 1分 |
| 77 | 2分 |
| 88 | 3分 |
| 99 | 4分 |
| TT | 5分 |
| JJ | 6分 |
| QQ | 7分 |
| KK | 8分 |
| AA | 9分 |
| 三條 | 10-22分 |

**中墩獎勵**
| 牌型 | 分數 |
|------|------|
| 三條 | 2分 |
| 順子 | 4分 |
| 同花 | 8分 |
| 葫蘆 | 12分 |
| 四條 | 20分 |
| 同花順 | 30分 |
| 皇家同花順 | 50分 |

**後墩獎勵**
| 牌型 | 分數 |
|------|------|
| 順子 | 2分 |
| 同花 | 4分 |
| 葫蘆 | 6分 |
| 四條 | 10分 |
| 同花順 | 15分 |
| 皇家同花順 | 25分 |

### Fantasy Land 規則

#### 進入條件
前墩達到QQ或更好的牌型（包括三條）

#### 特殊待遇
下一局開始時一次性獲得14-15張牌，可以看到所有牌後再決定擺放

#### 續留條件
- 前墩：三條
- 中墩：四條或更好
- 後墩：四條或更好

### 鬼牌使用規則

#### 基本規則
- 鬼牌可以代表任何一張牌
- 自動選擇能組成最佳牌型的牌
- 可以在同一手牌中使用多張鬼牌

#### 使用策略
- 優先用於完成高分值牌型
- 考慮整體佈局，不只是單一牌墩
- 注意避免犯規的風險

---

## 界面使用說明

### 主界面布局

#### 1. 頂部標題欄
顯示「🍍 OFC Solver GUI - 點擊式界面」

#### 2. 側邊欄（左側）
- **求解器設置**
  - 時間限制：設定AI思考時間（1-60秒）
  - 線程數：並行計算線程（1-8個）
  - 模擬次數：MCTS模擬次數（1,000-1,000,000）
  
- **API狀態**
  - 檢查連接按鈕：驗證後端服務狀態
  - 連接狀態指示：顯示當前連接情況
  
- **操作按鈕**
  - 清空所有選擇：重置所有已選牌

#### 3. 主要內容區（分為左右兩欄）

**左欄 - 卡牌選擇器**
- **輸入位置選擇器**
  - 當前抽到的牌
  - 玩家1各墩位（前/中/後）
  - 玩家2各墩位（前/中/後）
  
- **卡牌網格**
  - 按花色排列（黑桃♠、紅心♥、方塊♦、梅花♣）
  - 每個花色13張牌（A-K）
  - 灰色表示已使用的牌
  
- **當前牌局狀態**
  - 顯示各位置已選擇的牌
  - 每張牌旁有移除按鈕(❌)
  - 顯示當前牌數/最大牌數

**右欄 - 求解結果**
- **求解按鈕**：開始AI計算
- **最佳策略顯示**：展示推薦的擺放位置
- **評估信息**：期望分數、置信度、計算時間等
- **使用說明**：操作提示和快捷鍵說明

### 操作流程詳解

#### 1. 選擇輸入模式
根據當前遊戲階段選擇：
- **初始5張牌**: 選擇「當前抽到的牌」，輸入5張牌
- **查看對手牌況**: 輸入已知的對手牌到對應墩位
- **分析特定局面**: 設置完整的牌局狀態

#### 2. 輸入卡牌
1. 點擊目標位置按鈕（如「當前抽到的牌」）
2. 在卡牌網格中點擊要添加的牌
3. 已選的牌會顯示在下方狀態區
4. 錯誤選擇可點擊❌移除

#### 3. 求解最佳策略
1. 確認已輸入需要分析的牌
2. （可選）調整側邊欄的求解參數
3. 點擊「求解最佳策略」按鈕
4. 等待計算完成（通常5-30秒）

#### 4. 查看結果
- **擺放建議**: 大圖標顯示每張牌的推薦位置
- **期望分數**: AI預測的平均得分
- **置信度**: 推薦策略的可靠程度
- **計算詳情**: 模擬次數、計算時間等

### AI 建議使用方法

#### 理解AI推薦
- AI基於大量模擬給出統計最優解
- 考慮了所有可能的後續發牌情況
- 平衡了得分最大化和犯規風險

#### 何時參考AI
1. **初始5張牌擺放**: 這是最關鍵的決策點
2. **難以抉擇時**: 多個選擇看似相當
3. **學習階段**: 通過AI了解最優策略
4. **驗證想法**: 對比自己的判斷與AI建議

#### 注意事項
- AI假設對手也採用最優策略
- 實際對戰中需考慮對手風格
- 某些高風險高回報策略需謹慎採用

---

## 進階功能

### 設置說明

#### 時間限制
- **用途**: 控制AI思考時間
- **建議值**: 
  - 快速分析: 5-10秒
  - 標準分析: 10-30秒
  - 深度分析: 30-60秒
- **影響**: 時間越長，結果越準確

#### 線程數
- **用途**: 並行計算加速
- **建議值**: CPU核心數-1
- **注意**: 過多線程可能降低單線程效率

#### 模擬次數
- **用途**: MCTS搜索的迭代次數
- **建議值**:
  - 初學者: 10,000-50,000
  - 進階玩家: 100,000-500,000
  - 專業分析: 500,000+
- **權衡**: 次數越多越準確，但耗時更長

### 保存/載入遊戲

#### 保存當前局面
1. 設置完整的牌局狀態
2. 使用瀏覽器的收藏功能保存URL
3. URL包含完整的牌局信息

#### 載入已保存局面
1. 打開保存的URL
2. 系統自動恢復牌局狀態
3. 可繼續分析或修改

#### 導出分析結果
- 截圖保存推薦策略
- 複製文字結果到筆記
- 記錄關鍵決策點供日後參考

### 統計數據解讀

#### 期望分數
- **含義**: 採用推薦策略的平均得分
- **參考標準**:
  - 正值: 優勢局面
  - 0附近: 均勢
  - 負值: 劣勢局面

#### 置信度
- **含義**: AI對推薦策略的確信程度
- **解讀**:
  - 90%+: 非常確定的最優解
  - 70-90%: 較為可靠的建議
  - <70%: 局面複雜，多個選擇接近

#### 勝率預測
- **含義**: 獲勝的概率估計
- **用途**: 評估當前局面優劣
- **注意**: 基於雙方都採用最優策略

---

## 策略指南

### 初學者建議

#### 1. 基礎原則
- **安全第一**: 寧可保守也不要犯規
- **平衡發展**: 不要過度強化某一墩
- **留有餘地**: 早期保持靈活性

#### 2. 常見模式
- **對子分配**: 小對子放前墩，大對子放中墩
- **連牌處理**: 保留順子和同花的可能性
- **高牌運用**: A、K優先放在後墩

#### 3. 風險管理
- 避免前墩過強導致犯規
- 中墩不要過早鎖定弱牌型
- 為後續回合保留調整空間

### 進階技巧

#### 1. 期望值思維
- 計算每個決策的長期收益
- 考慮剩餘牌的分布概率
- 平衡即時收益與未來潛力

#### 2. 對手適應
- 觀察對手的擺牌習慣
- 針對保守型對手可以更激進
- 面對激進型對手要穩健

#### 3. 關鍵決策點
- **初始5張**: 決定整局框架
- **第10-11張**: 最後的調整機會
- **棄牌選擇**: 影響對手的可用牌

#### 4. Fantasy Land策略
- 積極追求QQ+在前墩
- 進入後的牌型規劃
- 續留條件的權衡

### 常見錯誤避免

#### 1. 過度追求獎勵分
- **錯誤**: 不顧犯規風險追求高分牌型
- **正確**: 先確保不犯規，再考慮獎勵分

#### 2. 忽視牌力梯度
- **錯誤**: 只關注單墩強度
- **正確**: 維持後墩≥中墩≥前墩

#### 3. 過早放棄
- **錯誤**: 開局不利就隨意擺放
- **正確**: 每個決策都追求最優

#### 4. 僵化思維
- **錯誤**: 固定模式應對所有局面
- **正確**: 根據具體牌況靈活調整

#### 5. 時間管理不當
- **錯誤**: 簡單決策耗時過長
- **正確**: 關鍵決策多思考，簡單局面快速處理

---

## 故障排除

### 常見問題 FAQ

#### Q1: 無法連接到API服務器
**解決方案**:
1. 確認已運行 `python run_api.py`
2. 檢查端口8000是否被占用
3. 嘗試重啟API服務器
4. 檢查防火牆設置

#### Q2: GUI界面無法打開
**解決方案**:
1. 確認Streamlit已正確安裝
2. 檢查端口8501是否可用
3. 嘗試手動打開 http://localhost:8501
4. 清除瀏覽器緩存

#### Q3: 求解速度很慢
**解決方案**:
1. 減少模擬次數
2. 降低時間限制
3. 增加線程數（如果CPU支持）
4. 關閉其他占用CPU的程序

#### Q4: 求解結果不合理
**可能原因**:
1. 輸入的牌局狀態有誤
2. 模擬次數太少
3. 存在已使用但未標記的牌

#### Q5: 界面顯示異常
**解決方案**:
1. 刷新瀏覽器頁面
2. 清除瀏覽器緩存
3. 嘗試其他瀏覽器
4. 檢查瀏覽器控制台錯誤

### 錯誤訊息處理

#### "卡牌已經被使用"
- **含義**: 嘗試選擇已在其他位置的牌
- **解決**: 先移除該牌的原位置再重新選擇

#### "API連接失敗"
- **含義**: 無法與後端服務通信
- **解決**: 確保API服務器正在運行

#### "求解超時"
- **含義**: 計算時間超過設定限制
- **解決**: 增加時間限制或減少模擬次數

#### "無效的遊戲狀態"
- **含義**: 輸入的牌局違反遊戲規則
- **解決**: 檢查是否有重複牌或超過數量限制

### 技術支援聯絡

#### GitHub Issues
- 項目地址: https://github.com/PWChenTW/PineappleSolver
- 提交Issue時請包含：
  - 錯誤描述
  - 重現步驟
  - 系統環境信息
  - 錯誤截圖

#### 社區支持
- Discord群組: [即將開放]
- 論壇討論: [即將開放]

#### 開發者聯繫
- 作者: PWChenTW
- GitHub: https://github.com/PWChenTW

### 系統日誌

#### 查看API日誌
```bash
# API服務器日誌位於運行終端
# 或查看 logs/api.log 文件
```

#### 查看GUI日誌
```bash
# Streamlit日誌顯示在運行終端
# 瀏覽器開發者工具查看前端錯誤
```

#### 啟用調試模式
```bash
# API調試模式
python run_api.py --debug

# GUI調試模式
streamlit run gui/app_v2.py --logger.level=debug
```

---

## 附錄

### 快捷鍵參考
- **Ctrl/Cmd + R**: 刷新頁面
- **F5**: 重新載入
- **Esc**: 取消當前操作

### 術語對照表
| 中文 | English | 說明 |
|------|---------|------|
| 前墩 | Front/Top | 3張牌的牌墩 |
| 中墩 | Middle | 中間5張牌的牌墩 |
| 後墩 | Back/Bottom | 最後5張牌的牌墩 |
| 犯規 | Foul | 違反牌力順序 |
| 獎勵分 | Royalty | 特殊牌型的額外分數 |
| 橫掃 | Scoop | 贏得所有三墩 |
| 夢幻樂園 | Fantasy Land | 特殊獎勵狀態 |

### 版本更新歷史
- v2.0: 點擊式界面，優化用戶體驗
- v1.0: 初始版本，基礎功能實現

---

*最後更新: 2025年1月*